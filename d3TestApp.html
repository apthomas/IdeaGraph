
<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}

</style>
<body>
<div id="viz">
</div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script>
// Things to do --change runD3 to take in 2 json's as parameters, edges and nodes and then put all this in the code in the runD3 function ---.

var testJson = {
  "54b78238bb9837baa14cf19f": {
    "text": "StateC = Object.create(ee);",
    "_id": "54b78238bb9837baa14cf19f",
    "dateCreated": "2015-01-15T09:02:48.752Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a0": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1a0",
    "dateCreated": "2015-01-15T09:02:48.752Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a1": {
    "text": "StateC.state = {}",
    "_id": "54b78238bb9837baa14cf1a1",
    "dateCreated": "2015-01-15T09:02:48.752Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a2": {
    "text": "\/\/ TODO store ideas as map",
    "_id": "54b78238bb9837baa14cf1a2",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a3": {
    "text": "\/\/ clientId: idea",
    "_id": "54b78238bb9837baa14cf1a3",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a4": {
    "text": "\/\/ onRender: save element in the dom",
    "_id": "54b78238bb9837baa14cf1a4",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a5": {
    "text": "\/\/           dynamic elements",
    "_id": "54b78238bb9837baa14cf1a5",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a6": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1a6",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a7": {
    "text": "\/\/ NEED TO SAVE DOM NODES ON RENDER",
    "_id": "54b78238bb9837baa14cf1a7",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a8": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1a8",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1a9": {
    "text": "\/\/ all of the ideas in a map",
    "_id": "54b78238bb9837baa14cf1a9",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1aa": {
    "text": "StateC.state.ideaMap = {}; \/\/ keyed by _id",
    "_id": "54b78238bb9837baa14cf1aa",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ab": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1ab",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ac": {
    "text": "StateC.state.currentParentId = 'root';",
    "_id": "54b78238bb9837baa14cf1ac",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ad": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1ad",
    "dateCreated": "2015-01-15T09:02:48.753Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ae": {
    "text": "\/\/ ideas for the current parent idea",
    "_id": "54b78238bb9837baa14cf1ae",
    "dateCreated": "2015-01-15T09:02:48.754Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1af": {
    "text": "StateC.state.activeIdeas = {}; \/\/ keyed by _id",
    "_id": "54b78238bb9837baa14cf1af",
    "dateCreated": "2015-01-15T09:02:48.754Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b0": {
    "text": "StateC.state.searchTerm = '';",
    "_id": "54b78238bb9837baa14cf1b0",
    "dateCreated": "2015-01-15T09:02:48.754Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b1": {
    "text": "\/\/ recursive ideas expanded",
    "_id": "54b78238bb9837baa14cf1b1",
    "dateCreated": "2015-01-15T09:02:48.754Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b2": {
    "text": "\/\/ key = INT level {0, 1, 2, ...}",
    "_id": "54b78238bb9837baa14cf1b2",
    "dateCreated": "2015-01-15T09:02:48.754Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b3": {
    "text": "\/\/ value = map of idea._id e.g. {3q4234: true}",
    "_id": "54b78238bb9837baa14cf1b3",
    "dateCreated": "2015-01-15T09:02:48.754Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b4": {
    "text": "StateC.state.recursiveIdeas = {};",
    "_id": "54b78238bb9837baa14cf1b4",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b5": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1b5",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b6": {
    "text": "\/\/ ideas that have been submitted by the ",
    "_id": "54b78238bb9837baa14cf1b6",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b7": {
    "text": "\/\/ user that have not been verified",
    "_id": "54b78238bb9837baa14cf1b7",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b8": {
    "text": "\/\/ by the server yet.",
    "_id": "54b78238bb9837baa14cf1b8",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1b9": {
    "text": "StateC.state.clientIdeas = {};",
    "_id": "54b78238bb9837baa14cf1b9",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ba": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1ba",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1bb": {
    "text": "StateC.state.autoCompleteParent = null;",
    "_id": "54b78238bb9837baa14cf1bb",
    "dateCreated": "2015-01-15T09:02:48.755Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1bc": {
    "text": "StateC.state.autoCompleteIdeas = [];",
    "_id": "54b78238bb9837baa14cf1bc",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1bd": {
    "text": "StateC.state.autoCompleteText = '';",
    "_id": "54b78238bb9837baa14cf1bd",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1be": {
    "text": "StateC.state.autocompleteSelected = '';",
    "_id": "54b78238bb9837baa14cf1be",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1bf": {
    "text": "StateC.state.autoCompleteFocus = '';",
    "_id": "54b78238bb9837baa14cf1bf",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c0": {
    "text": "\/\/ ",
    "_id": "54b78238bb9837baa14cf1c0",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c1": {
    "text": "StateC.state.relatedIdeasMap = {}; \/\/ keyed by _id",
    "_id": "54b78238bb9837baa14cf1c1",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c2": {
    "text": "StateC.state.viewItem = {};",
    "_id": "54b78238bb9837baa14cf1c2",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c3": {
    "text": "StateC.state.viewItem.activeView = 'listView';",
    "_id": "54b78238bb9837baa14cf1c3",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c4": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1c4",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c5": {
    "text": "\/\/ todo ",
    "_id": "54b78238bb9837baa14cf1c5",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c6": {
    "text": "\/\/ build list element map",
    "_id": "54b78238bb9837baa14cf1c6",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c7": {
    "text": "\/\/ getters and setters",
    "_id": "54b78238bb9837baa14cf1c7",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c8": {
    "text": "\/\/ dynamic element map",
    "_id": "54b78238bb9837baa14cf1c8",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1c9": {
    "text": "\/\/ onrender save references to dom nodes?",
    "_id": "54b78238bb9837baa14cf1c9",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ca": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1ca",
    "dateCreated": "2015-01-15T09:02:48.756Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1cb": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1cb",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1cc": {
    "text": "StateC.set = function(key, val) {",
    "_id": "54b78238bb9837baa14cf1cc",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1cd": {
    "text": "  StateC.state[key] = val;",
    "_id": "54b78238bb9837baa14cf1cd",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ce": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1ce",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1cf": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1cf",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d0": {
    "text": "StateC.setSearchTerm = function(data) {",
    "_id": "54b78238bb9837baa14cf1d0",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d1": {
    "text": "  StateC.state.searchTerm = data;",
    "_id": "54b78238bb9837baa14cf1d1",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d2": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1d2",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d3": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1d3",
    "dateCreated": "2015-01-15T09:02:48.757Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d4": {
    "text": "StateC.getSearchTerm = function(data) {",
    "_id": "54b78238bb9837baa14cf1d4",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d5": {
    "text": "  return StateC.state.searchTerm;",
    "_id": "54b78238bb9837baa14cf1d5",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d6": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1d6",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d7": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1d7",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d8": {
    "text": "StateC.setRelatedIdea = function(relation) {",
    "_id": "54b78238bb9837baa14cf1d8",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1d9": {
    "text": "  var map = StateC.state.relatedIdeasMap;",
    "_id": "54b78238bb9837baa14cf1d9",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1da": {
    "text": "  var id1 = relation.idea1Id;",
    "_id": "54b78238bb9837baa14cf1da",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1db": {
    "text": "  var id2 = relation.idea2Id;",
    "_id": "54b78238bb9837baa14cf1db",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1dc": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1dc",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1dd": {
    "text": "  var idea1Map = map[id1] || {};",
    "_id": "54b78238bb9837baa14cf1dd",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1de": {
    "text": "  var idea2Map = map[id2] || {};",
    "_id": "54b78238bb9837baa14cf1de",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1df": {
    "text": "  idea1Map[id2] = true;",
    "_id": "54b78238bb9837baa14cf1df",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e0": {
    "text": "  idea2Map[id1] = true;",
    "_id": "54b78238bb9837baa14cf1e0",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e1": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1e1",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e2": {
    "text": "  StateC.state.relatedIdeasMap[id1] = idea1Map;",
    "_id": "54b78238bb9837baa14cf1e2",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e3": {
    "text": "  StateC.state.relatedIdeasMap[id2] = idea2Map;",
    "_id": "54b78238bb9837baa14cf1e3",
    "dateCreated": "2015-01-15T09:02:48.758Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e4": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1e4",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e5": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1e5",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e6": {
    "text": "StateC.getIdeasMap = function() {",
    "_id": "54b78238bb9837baa14cf1e6",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e7": {
    "text": "  return StateC.state.ideaMap;",
    "_id": "54b78238bb9837baa14cf1e7",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e8": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1e8",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1e9": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1e9",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ea": {
    "text": "StateC.updateIdeaStatus = function(id) {",
    "_id": "54b78238bb9837baa14cf1ea",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1eb": {
    "text": "  var idea = StateC.getIdeasMap()[id];",
    "_id": "54b78238bb9837baa14cf1eb",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ec": {
    "text": "  var isLastStatus = idea.status === 3;",
    "_id": "54b78238bb9837baa14cf1ec",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ed": {
    "text": "  idea.status = isLastStatus ? 0 : idea.status + 1;",
    "_id": "54b78238bb9837baa14cf1ed",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ee": {
    "text": "  StateC.state.ideaMap[id] = idea;",
    "_id": "54b78238bb9837baa14cf1ee",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ef": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1ef",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f0": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1f0",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f1": {
    "text": "StateC.getParentId = function() {",
    "_id": "54b78238bb9837baa14cf1f1",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f2": {
    "text": "  return StateC.state.currentParentId;",
    "_id": "54b78238bb9837baa14cf1f2",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f3": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1f3",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f4": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1f4",
    "dateCreated": "2015-01-15T09:02:48.759Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f5": {
    "text": "StateC.setCurrentParentId = function(id) {",
    "_id": "54b78238bb9837baa14cf1f5",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f6": {
    "text": "  StateC.state.currentParentId = id;",
    "_id": "54b78238bb9837baa14cf1f6",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f7": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1f7",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f8": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1f8",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1f9": {
    "text": "StateC.getState = function(controller) {",
    "_id": "54b78238bb9837baa14cf1f9",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1fa": {
    "text": "  return this.state;",
    "_id": "54b78238bb9837baa14cf1fa",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1fb": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1fb",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1fc": {
    "text": "",
    "_id": "54b78238bb9837baa14cf1fc",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1fd": {
    "text": "StateC.getActiveView = function() {",
    "_id": "54b78238bb9837baa14cf1fd",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1fe": {
    "text": "  return StateC.state.viewItem.activeView;",
    "_id": "54b78238bb9837baa14cf1fe",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf1ff": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf1ff",
    "dateCreated": "2015-01-15T09:02:48.760Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf200": {
    "text": "",
    "_id": "54b78238bb9837baa14cf200",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf201": {
    "text": "StateC.updateRecursiveIdeas = function(parentTid, elemId) {",
    "_id": "54b78238bb9837baa14cf201",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf202": {
    "text": "  var levelMap = StateC.state.recursiveIdeas[parentTid] || {};",
    "_id": "54b78238bb9837baa14cf202",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf203": {
    "text": "  levelMap[elemId] = levelMap[elemId] ? false : true;",
    "_id": "54b78238bb9837baa14cf203",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf204": {
    "text": "",
    "_id": "54b78238bb9837baa14cf204",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf205": {
    "text": "  StateC.state.recursiveIdeas[parentTid] = levelMap;",
    "_id": "54b78238bb9837baa14cf205",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf206": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf206",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf207": {
    "text": "",
    "_id": "54b78238bb9837baa14cf207",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf208": {
    "text": "StateC.getAutoCompleteParent = function() {",
    "_id": "54b78238bb9837baa14cf208",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf209": {
    "text": "  return StateC.state.autoCompleteParent;",
    "_id": "54b78238bb9837baa14cf209",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf20a": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf20a",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf20b": {
    "text": "",
    "_id": "54b78238bb9837baa14cf20b",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf20c": {
    "text": "StateC.getAutoCompleteText = function() {",
    "_id": "54b78238bb9837baa14cf20c",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf20d": {
    "text": "  return StateC.state.autoCompleteText;",
    "_id": "54b78238bb9837baa14cf20d",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf20e": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf20e",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf20f": {
    "text": "",
    "_id": "54b78238bb9837baa14cf20f",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf210": {
    "text": "StateC.removeClientIdea = function(idea) {",
    "_id": "54b78238bb9837baa14cf210",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf211": {
    "text": "  delete StateC.state.clientIdeas[idea.clientId];",
    "_id": "54b78238bb9837baa14cf211",
    "dateCreated": "2015-01-15T09:02:48.761Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf212": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf212",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf213": {
    "text": "",
    "_id": "54b78238bb9837baa14cf213",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf214": {
    "text": "StateC.addIdeaToMap = function(idea) {",
    "_id": "54b78238bb9837baa14cf214",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf215": {
    "text": "  StateC.state.ideaMap[idea._id] = idea;",
    "_id": "54b78238bb9837baa14cf215",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf216": {
    "text": "  StateC.emit('ideas.changed');",
    "_id": "54b78238bb9837baa14cf216",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf217": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf217",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf218": {
    "text": "",
    "_id": "54b78238bb9837baa14cf218",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf219": {
    "text": "StateC.findIdeaById = function(id) {",
    "_id": "54b78238bb9837baa14cf219",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf21a": {
    "text": "  \/\/ console.log('findIdeaByClientId', id);",
    "_id": "54b78238bb9837baa14cf21a",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf21b": {
    "text": "  return StateC.state.ideaMap[id];",
    "_id": "54b78238bb9837baa14cf21b",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf21c": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf21c",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf21d": {
    "text": "",
    "_id": "54b78238bb9837baa14cf21d",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf21e": {
    "text": "StateC.setActiveIdeas = function() {",
    "_id": "54b78238bb9837baa14cf21e",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf21f": {
    "text": "  var activeIdeas = _.filter(StateC.state.ideaMap, function(idea, id) {",
    "_id": "54b78238bb9837baa14cf21f",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf220": {
    "text": "    var isChildOfCurrentView = idea.parentId === StateC.state.currentParentId;",
    "_id": "54b78238bb9837baa14cf220",
    "dateCreated": "2015-01-15T09:02:48.762Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf221": {
    "text": "    var searchTerm = StateC.getSearchTerm();",
    "_id": "54b78238bb9837baa14cf221",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf222": {
    "text": "    var matchesSearch = searchTerm ? UtilC.matchesText(searchTerm, idea.text) : true;",
    "_id": "54b78238bb9837baa14cf222",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf223": {
    "text": "    return isChildOfCurrentView && matchesSearch;",
    "_id": "54b78238bb9837baa14cf223",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf224": {
    "text": "  });",
    "_id": "54b78238bb9837baa14cf224",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf225": {
    "text": "",
    "_id": "54b78238bb9837baa14cf225",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf226": {
    "text": "  activeIdeas = _.sortBy(activeIdeas, function(elem) {",
    "_id": "54b78238bb9837baa14cf226",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf227": {
    "text": "    return -(new Date(elem.dateCreated)).getTime();",
    "_id": "54b78238bb9837baa14cf227",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf228": {
    "text": "  });",
    "_id": "54b78238bb9837baa14cf228",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf229": {
    "text": "  \/\/ console.log('activeIdeas', _.map(_.pluck(activeIdeas, 'dateCreated'), function(thing) {return (new Date(thing)).getTime()}));",
    "_id": "54b78238bb9837baa14cf229",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf22a": {
    "text": "  StateC.state.activeIdeas = activeIdeas;",
    "_id": "54b78238bb9837baa14cf22a",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf22b": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf22b",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf22c": {
    "text": "",
    "_id": "54b78238bb9837baa14cf22c",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf22d": {
    "text": "StateC.getRecursiveIdeas = function(currentId) {",
    "_id": "54b78238bb9837baa14cf22d",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf22e": {
    "text": "  var recursiveIdeas = StateC.state.recursiveIdeas[currentId];",
    "_id": "54b78238bb9837baa14cf22e",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf22f": {
    "text": "  \/\/ console.log(recursiveIdeas);",
    "_id": "54b78238bb9837baa14cf22f",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf230": {
    "text": "  \/\/ {id: true or false}",
    "_id": "54b78238bb9837baa14cf230",
    "dateCreated": "2015-01-15T09:02:48.763Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf231": {
    "text": "  \/\/ now map to {id: idea}",
    "_id": "54b78238bb9837baa14cf231",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf232": {
    "text": "  var recursiveMap = {}",
    "_id": "54b78238bb9837baa14cf232",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf233": {
    "text": "  if (recursiveIdeas) {",
    "_id": "54b78238bb9837baa14cf233",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf234": {
    "text": "    recursiveIdeas = _.each(recursiveIdeas, function(truthVal, id) {",
    "_id": "54b78238bb9837baa14cf234",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf235": {
    "text": "      if (truthVal) recursiveMap[id] = StateC.getIdeasMap()[id];",
    "_id": "54b78238bb9837baa14cf235",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf236": {
    "text": "    });",
    "_id": "54b78238bb9837baa14cf236",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf237": {
    "text": "  }",
    "_id": "54b78238bb9837baa14cf237",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf238": {
    "text": "  \/\/ console.log('recursiveMap', recursiveMap);",
    "_id": "54b78238bb9837baa14cf238",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf239": {
    "text": "  return recursiveMap;",
    "_id": "54b78238bb9837baa14cf239",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf23a": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf23a",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf23b": {
    "text": "",
    "_id": "54b78238bb9837baa14cf23b",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf23c": {
    "text": "StateC.clearAutocomplete = function() {",
    "_id": "54b78238bb9837baa14cf23c",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf23d": {
    "text": "  var autoParent = StateC.getAutoCompleteParent();",
    "_id": "54b78238bb9837baa14cf23d",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf23e": {
    "text": "  StateC.state.autoCompleteParent = null;",
    "_id": "54b78238bb9837baa14cf23e",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf23f": {
    "text": "  StateC.emit('autoCompleteParent.cleared', autoParent);",
    "_id": "54b78238bb9837baa14cf23f",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf240": {
    "text": "  StateC.state.autoCompleteIdeas = [];",
    "_id": "54b78238bb9837baa14cf240",
    "dateCreated": "2015-01-15T09:02:48.764Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf241": {
    "text": "  StateC.state.autoCompleteText = '';",
    "_id": "54b78238bb9837baa14cf241",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf242": {
    "text": "  StateC.state.autocompleteSelected = '';",
    "_id": "54b78238bb9837baa14cf242",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf243": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf243",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf244": {
    "text": "",
    "_id": "54b78238bb9837baa14cf244",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf245": {
    "text": "\/\/ StateC.saveIdeaContainer = function(guid) {",
    "_id": "54b78238bb9837baa14cf245",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf246": {
    "text": "\/\/   StateC.state.listViewElem[guid] = StateC.state.listViewElem[guid] ||",
    "_id": "54b78238bb9837baa14cf246",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf247": {
    "text": "\/\/                                     UtilC.guid();",
    "_id": "54b78238bb9837baa14cf247",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf248": {
    "text": "\/\/ }",
    "_id": "54b78238bb9837baa14cf248",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf249": {
    "text": "",
    "_id": "54b78238bb9837baa14cf249",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf24a": {
    "text": "StateC.on('click.viewItem.*', function(tag) {",
    "_id": "54b78238bb9837baa14cf24a",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf24b": {
    "text": "  \/\/ console.log('statec click viewItem', StateC.state)",
    "_id": "54b78238bb9837baa14cf24b",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf24c": {
    "text": "  StateC.state.viewItem.activeView = tag + 'View';",
    "_id": "54b78238bb9837baa14cf24c",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf24d": {
    "text": "  StateC.emit('viewItem.activeView.changed');",
    "_id": "54b78238bb9837baa14cf24d",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf24e": {
    "text": "});",
    "_id": "54b78238bb9837baa14cf24e",
    "dateCreated": "2015-01-15T09:02:48.765Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf24f": {
    "text": "",
    "_id": "54b78238bb9837baa14cf24f",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf250": {
    "text": "StateC.on('server.state.received', function(state) {",
    "_id": "54b78238bb9837baa14cf250",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf251": {
    "text": "  StateC.state.ideaMap = UtilC.listToObj(state.ideas, '_id');",
    "_id": "54b78238bb9837baa14cf251",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf252": {
    "text": "  StateC.setActiveIdeas();",
    "_id": "54b78238bb9837baa14cf252",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf253": {
    "text": "  console.log('state.relations', state.relations);",
    "_id": "54b78238bb9837baa14cf253",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf254": {
    "text": "  _.each(state.relations, function(relation) {",
    "_id": "54b78238bb9837baa14cf254",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf255": {
    "text": "    StateC.setRelatedIdea(relation);",
    "_id": "54b78238bb9837baa14cf255",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf256": {
    "text": "  });",
    "_id": "54b78238bb9837baa14cf256",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf257": {
    "text": "  StateC.emit('state.initialized');",
    "_id": "54b78238bb9837baa14cf257",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf258": {
    "text": "});",
    "_id": "54b78238bb9837baa14cf258",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf259": {
    "text": "",
    "_id": "54b78238bb9837baa14cf259",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf25a": {
    "text": "StateC.on('new.idea', function(idea) {",
    "_id": "54b78238bb9837baa14cf25a",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf25b": {
    "text": "  console.log('new.idea', StateC.state.ideaMap);",
    "_id": "54b78238bb9837baa14cf25b",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf25c": {
    "text": "  StateC.state.clientIdeas[idea.clientId] = idea;",
    "_id": "54b78238bb9837baa14cf25c",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf25d": {
    "text": "  StateC.emit('clientIdea.created');",
    "_id": "54b78238bb9837baa14cf25d",
    "dateCreated": "2015-01-15T09:02:48.766Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf25e": {
    "text": "});",
    "_id": "54b78238bb9837baa14cf25e",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf25f": {
    "text": "",
    "_id": "54b78238bb9837baa14cf25f",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf260": {
    "text": "StateC.setAutoCompleteSelector = function(force) {",
    "_id": "54b78238bb9837baa14cf260",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf261": {
    "text": "  var autoIdeas = StateC.state.autoCompleteIdeas;",
    "_id": "54b78238bb9837baa14cf261",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf262": {
    "text": "  \/\/ console.log('setSelector', StateC.state.autoCompleteIdeas);",
    "_id": "54b78238bb9837baa14cf262",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf263": {
    "text": "  \/\/ console.log('setSelector2', StateC.state.autocompleteSelected);",
    "_id": "54b78238bb9837baa14cf263",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf264": {
    "text": "  if (autoIdeas.length && !StateC.state.autocompleteSelected) {",
    "_id": "54b78238bb9837baa14cf264",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf265": {
    "text": "    StateC.state.autocompleteSelected = autoIdeas[0].idea._id;",
    "_id": "54b78238bb9837baa14cf265",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf266": {
    "text": "  }",
    "_id": "54b78238bb9837baa14cf266",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf267": {
    "text": "}",
    "_id": "54b78238bb9837baa14cf267",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf268": {
    "text": "",
    "_id": "54b78238bb9837baa14cf268",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf269": {
    "text": "StateC.on('focus.autoCompleteWrapper', function($elem) {",
    "_id": "54b78238bb9837baa14cf269",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf26a": {
    "text": "  console.log('focus.autoCompleteWrapper', $elem);",
    "_id": "54b78238bb9837baa14cf26a",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf26b": {
    "text": "  StateC.state.autoCompleteFocus = '';",
    "_id": "54b78238bb9837baa14cf26b",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf26c": {
    "text": "  var previousAutoCompleteParent = StateC.getAutoCompleteParent();",
    "_id": "54b78238bb9837baa14cf26c",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf26d": {
    "text": "  if (previousAutoCompleteParent) {",
    "_id": "54b78238bb9837baa14cf26d",
    "dateCreated": "2015-01-15T09:02:48.767Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf26e": {
    "text": "    StateC.clearAutocomplete();",
    "_id": "54b78238bb9837baa14cf26e",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf26f": {
    "text": "    StateC.emit('autoCompleteParent.removed', previousAutoCompleteParent);",
    "_id": "54b78238bb9837baa14cf26f",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf270": {
    "text": "  }",
    "_id": "54b78238bb9837baa14cf270",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf271": {
    "text": "  StateC.state.autoCompleteParent = $elem;",
    "_id": "54b78238bb9837baa14cf271",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf272": {
    "text": "  StateC.state.autoCompleteText = $elem.find('input').val();",
    "_id": "54b78238bb9837baa14cf272",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf273": {
    "text": "  StateC.setAutoCompleteIdeas();",
    "_id": "54b78238bb9837baa14cf273",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf274": {
    "text": "  StateC.setAutoCompleteSelector();",
    "_id": "54b78238bb9837baa14cf274",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf275": {
    "text": "  StateC.emit('autoCompleteParent.added', $elem);",
    "_id": "54b78238bb9837baa14cf275",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78238bb9837baa14cf276": {
    "text": "});",
    "_id": "54b78238bb9837baa14cf276",
    "dateCreated": "2015-01-15T09:02:48.768Z",
    "status": 0,
    "parentId": "root"
  },
  "54b7825fbb9837baa14cf280": {
    "text": "autom",
    "clientId": "f84dd515-9155-eb25-4fe1-195ff6ccdaa2",
    "_id": "54b7825fbb9837baa14cf280",
    "dateCreated": "2015-01-15T09:03:27.472Z",
    "status": 0,
    "parentId": "root"
  },
  "54b78277bb9837baa14cf288": {
    "text": "#autoComplete",
    "clientId": "127d43d7-f578-5c39-7a06-2bf375fca65f",
    "_id": "54b78277bb9837baa14cf288",
    "dateCreated": "2015-01-15T09:03:51.099Z",
    "status": 0,
    "parentId": "root"
  }
}
var edgesJson = {
  "54b78238bb9837baa14cf1a1": {
    "54b78238bb9837baa14cf26e": true
  },
  "54b78238bb9837baa14cf26e": {
    "54b78238bb9837baa14cf1a1": true,
    "54b78238bb9837baa14cf1aa": true,
    "54b78238bb9837baa14cf1a2": true
  },
  "54b78238bb9837baa14cf1aa": {
    "54b78238bb9837baa14cf26e": true
  },
  "54b78238bb9837baa14cf1a2": {
    "54b78238bb9837baa14cf26e": true
  },
  "54b78238bb9837baa14cf1bb": {
    "54b78238bb9837baa14cf274": true,
    "54b78238bb9837baa14cf273": true,
    "54b78238bb9837baa14cf272": true,
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf274": {
    "54b78238bb9837baa14cf1bb": true,
    "54b78238bb9837baa14cf1bc": true,
    "54b78238bb9837baa14cf1bd": true,
    "54b78238bb9837baa14cf1be": true,
    "54b78238bb9837baa14cf1bf": true
  },
  "54b78238bb9837baa14cf1bc": {
    "54b78238bb9837baa14cf274": true,
    "54b78238bb9837baa14cf273": true,
    "54b78238bb9837baa14cf272": true,
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf1bd": {
    "54b78238bb9837baa14cf274": true,
    "54b78238bb9837baa14cf273": true,
    "54b78238bb9837baa14cf272": true,
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf1be": {
    "54b78238bb9837baa14cf274": true,
    "54b78238bb9837baa14cf273": true,
    "54b78238bb9837baa14cf272": true,
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf1bf": {
    "54b78238bb9837baa14cf274": true,
    "54b78238bb9837baa14cf272": true,
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf273": {
    "54b78238bb9837baa14cf1bb": true,
    "54b7825fbb9837baa14cf280": true,
    "54b78238bb9837baa14cf1bc": true,
    "54b78238bb9837baa14cf1bd": true,
    "54b78238bb9837baa14cf1be": true
  },
  "54b7825fbb9837baa14cf280": {
    "54b78238bb9837baa14cf273": true
  },
  "54b78238bb9837baa14cf272": {
    "54b78238bb9837baa14cf1bb": true,
    "54b78238bb9837baa14cf1bc": true,
    "54b78238bb9837baa14cf1bd": true,
    "54b78277bb9837baa14cf288": true,
    "54b78238bb9837baa14cf1be": true,
    "54b78238bb9837baa14cf1bf": true
  },
  "54b78277bb9837baa14cf288": {
    "54b78238bb9837baa14cf272": true
  },
  "54b78238bb9837baa14cf271": {
    "54b78238bb9837baa14cf1bb": true,
    "54b78238bb9837baa14cf1bc": true,
    "54b78238bb9837baa14cf1bd": true,
    "54b78238bb9837baa14cf1be": true,
    "54b78238bb9837baa14cf1bf": true,
    "54b78238bb9837baa14cf208": true,
    "54b78238bb9837baa14cf209": true,
    "54b78238bb9837baa14cf20c": true,
    "54b78238bb9837baa14cf20d": true
  },
  "54b78238bb9837baa14cf208": {
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf209": {
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf20c": {
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf20d": {
    "54b78238bb9837baa14cf271": true,
    "54b78238bb9837baa14cf275": true
  },
  "54b78238bb9837baa14cf275": {
    "54b78238bb9837baa14cf1bb": true,
    "54b78238bb9837baa14cf1bc": true,
    "54b78238bb9837baa14cf1bd": true,
    "54b78238bb9837baa14cf1be": true,
    "54b78238bb9837baa14cf1bf": true,
    "54b78238bb9837baa14cf208": true,
    "54b78238bb9837baa14cf209": true,
    "54b78238bb9837baa14cf20c": true,
    "54b78238bb9837baa14cf20d": true
  }
}
// var dataset;
// var nodesT=[];
// var edgesT =[];
// var hash = {};
// function organizeJson(json,edgeJson){
  
//   var countT = 0;
//   for (var i in json){
//     nodesT.push({"name": json[i]._id});
//     hash[i] = countT;
//     countT +=1;
//   }
//   for (var j in edgeJson){
//     for (var a in edgeJson[j]){
//       edgesT.push({"source": hash[j], "target": hash[a]});
//     }
//   }
//   dataset={"nodes": nodesT, "edges": edgesT};
// }
// organizeJson(testJson,edgesJson);

//  var w = 1900;
//   var h = 1200;
 
//   // dataset.nodes = state.ideas;

//   var svg = d3.select('#viz').append("svg")
//               .attr('width', w)
//               .attr('height', h)

//   // var svg = d3.select('body')
//   //             .append('svg')
//   //             .attr('width', w)
//   //             .attr('height', h)

//   var colors = d3.scale.category10();
//   var force = d3.layout.force()
//                        .nodes(dataset.nodes)
//                        .links(dataset.edges)
//                        .size([w,h])
//                        .linkDistance([50])
//                        .charge([-100]);
                       

//   var edges = svg.selectAll('line')
//                  .data(dataset.edges)
//                  .enter()
//                  .append('line')
//                  .style('stroke', '#ccc')
//                  .style('stroke-width', 1);

//   var nodes = svg.selectAll('circle')
//                  .data(dataset.nodes)
//                  .enter()
//                  .append('circle')
//                  .attr('r', 10)
//                  .style('fill', function(d, i) {
//                     return colors(i);
//                  })
//                  .call(force.drag)

//   var n = force.nodes().length;
//   force.nodes().forEach(function(d, i) {
//     d.x = d.y = w / n * i;
//   });

//   setTimeout(function(){
//     force.start();
//     for (var i = 0; i < n; ++i) force.tick();
//     force.stop();
//   },300);


//   force.on('tick', function() {
//     edges.attr('x1', function(d) { return d.source.x; })
//          .attr('y1', function(d) { return d.source.y; })
//          .attr('x2', function(d) { return d.target.x; })
//          .attr('y2', function(d) { return d.target.y; })

//     nodes.attr('cx', function(d) { return d.x })
//          .attr('cy', function(d) { return d.y })

//   })

// set up SVG for D3
var width  = 900,
    height = 500,
    colors = d3.scale.category10();

var svg = d3.select('body')
  .append('svg')
  .attr('width', width)
  .attr('height', height);

// set up initial nodes and links
//  - nodes are known by 'id', not by index in array.
//  - reflexive edges are indicated on the node (as a bold black circle).
//  - links are always source < target; edge directions are set by 'left' and 'right'.

var dataset;
var nodes=[];
var links =[];
var hash = {};
function organizeJson(json,edgeJson){
  
  var countT = 0;
  for (var i in json){
    nodes.push({"id": json[i]._id, "reflexive":false});
    hash[i] = countT;
    countT +=1;
  }
  lastNodeId = countT;
  for (var j in edgeJson){
    for (var a in edgeJson[j]){
      links.push({"source": hash[j], "target": hash[a], "left":false, "right":true});
    }
  }
  dataset={"nodes": nodes, "links": links};
}
organizeJson(testJson,edgesJson);
// var nodes = [
//     {id: 0, reflexive: false},
//     {id: 1, reflexive: true },
//     {id: 2, reflexive: false}
//   ],
//   lastNodeId = 2,
//   links = [
//     {source: nodes[0], target: nodes[1], left: false, right: true },
//     {source: nodes[1], target: nodes[2], left: false, right: true }
//   ];

// init D3 force layout
var force = d3.layout.force()
    .nodes(nodes)
    .links(links)
    .size([width, height])
    .linkDistance(100)
    .charge(-200)
    .on('tick', tick)

// define arrow markers for graph links
svg.append('svg:defs').append('svg:marker')
    .attr('id', 'end-arrow')
    .attr('viewBox', '0 -5 10 10')
    .attr('refX', 6)
    .attr('markerWidth', 3)
    .attr('markerHeight', 3)
    .attr('orient', 'auto')
  .append('svg:path')
    .attr('d', 'M0,-5L10,0L0,5')
    .attr('fill', '#000');

svg.append('svg:defs').append('svg:marker')
    .attr('id', 'start-arrow')
    .attr('viewBox', '0 -5 10 10')
    .attr('refX', 4)
    .attr('markerWidth', 3)
    .attr('markerHeight', 3)
    .attr('orient', 'auto')
  .append('svg:path')
    .attr('d', 'M10,-5L0,0L10,5')
    .attr('fill', '#000');

// line displayed when dragging new nodes
var drag_line = svg.append('svg:path')
  .attr('class', 'link dragline hidden')
  .attr('d', 'M0,0L0,0');

// handles to link and node element groups
var path = svg.append('svg:g').selectAll('path'),
    circle = svg.append('svg:g').selectAll('g');

// mouse event vars
var selected_node = null,
    selected_link = null,
    mousedown_link = null,
    mousedown_node = null,
    mouseup_node = null;

var n = force.nodes().length;
  force.nodes().forEach(function(d, i) {
    d.x = d.y = width / n * i;
  });

function resetMouseVars() {
  mousedown_node = null;
  mouseup_node = null;
  mousedown_link = null;
}

// update force layout (called automatically each iteration)
function tick() {
  // draw directed edges with proper padding from node centers
  path.attr('d', function(d) {
    var deltaX = d.target.x - d.source.x,
        deltaY = d.target.y - d.source.y,
        dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY),
        normX = deltaX / dist,
        normY = deltaY / dist,
        sourcePadding = d.left ? 17 : 12,
        targetPadding = d.right ? 17 : 12,
        sourceX = d.source.x + (sourcePadding * normX),
        sourceY = d.source.y + (sourcePadding * normY),
        targetX = d.target.x - (targetPadding * normX),
        targetY = d.target.y - (targetPadding * normY);
    return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;
  });

  circle.attr('transform', function(d) {
    return 'translate(' + d.x + ',' + d.y + ')';
  });
}

// update graph (called when needed)
function restart() {
  // path (link) group
  path = path.data(links);

  // update existing links
  path.classed('selected', function(d) { return d === selected_link; })
    .style('marker-start', function(d) { return d.left ? 'url(#start-arrow)' : ''; })
    .style('marker-end', function(d) { return d.right ? 'url(#end-arrow)' : ''; });


  // add new links
  path.enter().append('svg:path')
    .attr('class', 'link')
    .classed('selected', function(d) { return d === selected_link; })
    .style('marker-start', function(d) { return d.left ? 'url(#start-arrow)' : ''; })
    .style('marker-end', function(d) { return d.right ? 'url(#end-arrow)' : ''; })
    .on('mousedown', function(d) {
      if(d3.event.ctrlKey) return;

      // select link
      mousedown_link = d;
      if(mousedown_link === selected_link) selected_link = null;
      else selected_link = mousedown_link;
      selected_node = null;
      restart();
    });

  // remove old links
  path.exit().remove();


  // circle (node) group
  // NB: the function arg is crucial here! nodes are known by id, not by index!
  circle = circle.data(nodes, function(d) { return d.id; });

  // update existing nodes (reflexive & selected visual states)
  circle.selectAll('circle')
    .style('fill', function(d) { return (d === selected_node) ? d3.rgb(colors(d.idS)).brighter().toString() : colors(d.id); })
    .classed('reflexive', function(d) { return d.reflexive; });

  // add new nodes
  var g = circle.enter().append('svg:g');

  g.append('svg:circle')
    .attr('class', 'node')
    .attr('r', 12)
    .style('fill', function(d) { return (d === selected_node) ? d3.rgb(colors(d.id)).brighter().toString() : colors(d.id); })
    .style('stroke', function(d) { return d3.rgb(colors(d.id)).darker().toString(); })
    .classed('reflexive', function(d) { return d.reflexive; })
    .on('mouseover', function(d) {
      if(!mousedown_node || d === mousedown_node) return;
      // enlarge target node
      d3.select(this).attr('transform', 'scale(1.1)');
    })
    .on('mouseout', function(d) {
      if(!mousedown_node || d === mousedown_node) return;
      // unenlarge target node
      d3.select(this).attr('transform', '');
    })
    .on('mousedown', function(d) {
      if(d3.event.ctrlKey) return;

      // select node
      mousedown_node = d;
      if(mousedown_node === selected_node) selected_node = null;
      else selected_node = mousedown_node;
      selected_link = null;

      // reposition drag line
      drag_line
        .style('marker-end', 'url(#end-arrow)')
        .classed('hidden', false)
        .attr('d', 'M' + mousedown_node.x + ',' + mousedown_node.y + 'L' + mousedown_node.x + ',' + mousedown_node.y);

      restart();
    })
    .on('mouseup', function(d) {
      if(!mousedown_node) return;

      // needed by FF
      drag_line
        .classed('hidden', true)
        .style('marker-end', '');

      // check for drag-to-self
      mouseup_node = d;
      if(mouseup_node === mousedown_node) { resetMouseVars(); return; }

      // unenlarge target node
      d3.select(this).attr('transform', '');

      // add link to graph (update if exists)
      // NB: links are strictly source < target; arrows separately specified by booleans
      var source, target, direction;
      if(mousedown_node.id < mouseup_node.id) {
        source = mousedown_node;
        target = mouseup_node;
        direction = 'right';
      } else {
        source = mouseup_node;
        target = mousedown_node;
        direction = 'left';
      }

      var link;
      link = links.filter(function(l) {
        return (l.source === source && l.target === target);
      })[0];

      if(link) {
        link[direction] = true;
      } else {
        link = {source: source, target: target, left: false, right: false};
        link[direction] = true;
        links.push(link);
      }

      // select new link
      selected_link = link;
      selected_node = null;
      restart();
    });

  // show node IDs
  g.append('svg:text')
      .attr('x', 3)
      .attr('y', 24)
      .attr('class', 'id')
      .text(function(d) { return hash[d.id]; });  //need to truncate string.---change 
      // text shown here and positioning of text here.

  // remove old nodes
  circle.exit().remove();

  force.start();
  // for (var i = 0; i < n; ++i) force.start();
  // force.stop();
  // // set the graph in motion
  // setTimeout(function(){
    
    
    
  // },300);

}

function mousedown() {
  // prevent I-bar on drag
  //d3.event.preventDefault();
  
  // because :active only works in WebKit?
  svg.classed('active', true);

  if(d3.event.ctrlKey || mousedown_node || mousedown_link) return;

  // insert new node at point
  var point = d3.mouse(this),
      node = {id: ++lastNodeId, reflexive: false};
  node.x = point[0];
  node.y = point[1];
  nodes.push(node);

  restart();
}

function mousemove() {
  if(!mousedown_node) return;

  // update drag line
  drag_line.attr('d', 'M' + mousedown_node.x + ',' + mousedown_node.y + 'L' + d3.mouse(this)[0] + ',' + d3.mouse(this)[1]);

  restart();
}

function mouseup() {
  if(mousedown_node) {
    // hide drag line
    drag_line
      .classed('hidden', true)
      .style('marker-end', '');
  }

  // because :active only works in WebKit?
  svg.classed('active', false);

  // clear mouse event vars
  resetMouseVars();
}

function spliceLinksForNode(node) {
  var toSplice = links.filter(function(l) {
    return (l.source === node || l.target === node);
  });
  toSplice.map(function(l) {
    links.splice(links.indexOf(l), 1);
  });
}

// only respond once per keydown
var lastKeyDown = -1;

function keydown() {
  d3.event.preventDefault();

  if(lastKeyDown !== -1) return;
  lastKeyDown = d3.event.keyCode;

  // ctrl
  if(d3.event.keyCode === 17) {
    circle.call(force.drag);
    svg.classed('ctrl', true);
  }

  if(!selected_node && !selected_link) return;
  switch(d3.event.keyCode) {
    case 8: // backspace
    case 46: // delete
      if(selected_node) {
        nodes.splice(nodes.indexOf(selected_node), 1);
        spliceLinksForNode(selected_node);
      } else if(selected_link) {
        links.splice(links.indexOf(selected_link), 1);
      }
      selected_link = null;
      selected_node = null;
      restart();
      break;
    case 66: // B
      if(selected_link) {
        // set link direction to both left and right
        selected_link.left = true;
        selected_link.right = true;
      }
      restart();
      break;
    case 76: // L
      if(selected_link) {
        // set link direction to left only
        selected_link.left = true;
        selected_link.right = false;
      }
      restart();
      break;
    case 82: // R
      if(selected_node) {
        // toggle node reflexivity
        selected_node.reflexive = !selected_node.reflexive;
      } else if(selected_link) {
        // set link direction to right only
        selected_link.left = false;
        selected_link.right = true;
      }
      restart();
      break;
  }
}

function keyup() {
  lastKeyDown = -1;

  // ctrl
  if(d3.event.keyCode === 17) {
    circle
      .on('mousedown.drag', null)
      .on('touchstart.drag', null);
    svg.classed('ctrl', false);
  }
}

// app starts here
svg.on('mousedown', mousedown)
  .on('mousemove', mousemove)
  .on('mouseup', mouseup);
d3.select(window)
  .on('keydown', keydown)
  .on('keyup', keyup);
restart();
  
  

</script>
 